<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>LazyMan</title>
</head>

<body>
  <script>

    function LazyMan(name) {
      if (this.constructor !== LazyMan) {
        return new LazyMan(name)
      }
      this.task = []
      var _this = this
      var fn = function () {
        console.log('Hi! This is %s', name)
        _this.next()
      }
      this.task.push(fn)
      setTimeout(() => {
        _this.next() // 等待所有任务初始化完成后，在下一个事件循环开始执行任务task
      }, 0);
    }

    LazyMan.prototype.next = function () {
      var fn = this.task.shift()
      fn && fn()
    }
    LazyMan.prototype.eat = function (food) {
      var _this = this
      var fn = function () {
        console.log('eat %s', food)
        _this.next()
      }
      this.task.push(fn)
      return this
    }
    LazyMan.prototype.sleep = function (time) {
      var _this = this
      var fn = function () {
        console.log('Wake up after %s s', time)
        setTimeout(() => {
          _this.next()
        }, time * 1000);
      }
      this.task.push(fn)
      return this
    }
    LazyMan.prototype.sleepFirst = function (time) {
      var _this = this
      var fn = function () {
        console.log('SleepFirst, Wake up after %s s', time)
        setTimeout(() => {
          _this.next()
        }, time * 1000);
      }
      this.task.unshift(fn)
      return this
    }

    LazyMan('Tom').sleep(5).eat('apple').sleepFirst(3)
  </script>
</body>

</html>